<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alat Skrining Mata - Visus & Buta Warna</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f0f7ff;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header dengan lebar penuh */
        .main-header {
            text-align: center;
            padding: 20px 0;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            width: 100%;
        }

        .logo-container {
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .logo {
            height: 60px;
            width: auto;
            border-radius: 8px;
            background-color: white;
            padding: 5px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Container utama dengan grid 2 kolom */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            width: 100%;
        }

        /* Semua section memiliki lebar yang sama */
        .main-section {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            width: 100%;
        }

        /* Section yang memenuhi lebar penuh */
        .full-width-section {
            grid-column: 1 / -1;
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            width: 100%;
        }

        .section-title {
            color: #2a5298;
            border-bottom: 3px solid #4dabf7;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: #4dabf7;
        }

        .instruction-box {
            background-color: #e7f5ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #4dabf7;
            width: 100%;
        }

        .instruction-box h3 {
            color: #1864ab;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Snellen Chart */
        .chart-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 500px;
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
            position: relative;
            width: 100%;
        }

        .chart-row {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
            width: 100%;
            position: relative;
        }

        .chart-letter {
            display: inline-block;
            font-weight: bold;
            text-align: center;
            color: black;
            margin: 0 5px;
            position: relative;
        }

        .letter-E {
            transform: rotate(90deg);
            display: inline-block;
        }

        .visus-value {
            position: absolute;
            left: 10px;
            font-size: 0.9rem;
            color: #1864ab;
            font-weight: 600;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid #4dabf7;
            min-width: 60px;
            text-align: center;
        }

        /* Astigmatisma Chart */
        .astigmatism-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            width: 100%;
        }

        .astigmatism-wheel {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, white 30%, #f8f9fa 100%);
            position: relative;
            margin: 20px auto;
            border: 2px solid #dee2e6;
            overflow: hidden;
        }

        .astigmatism-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background-color: black;
            top: 50%;
            transform-origin: center;
        }

        /* Kontrol Tes Visus */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            width: 100%;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 150px;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
        }

        select, input, button {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #ced4da;
            font-size: 1rem;
            width: 100%;
        }

        button {
            background-color: #339af0;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:hover {
            background-color: #1c7ed6;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .primary-btn {
            background-color: #40c057;
        }

        .primary-btn:hover {
            background-color: #2f9e44;
        }

        .secondary-btn {
            background-color: #6c757d;
        }

        .secondary-btn:hover {
            background-color: #5a6268;
        }

        /* Form Kesimpulan */
        .conclusion-form textarea {
            width: 100%;
            height: 150px;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #ced4da;
            font-size: 1rem;
            margin-bottom: 20px;
            resize: vertical;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            width: 100%;
        }

        .form-row .control-group {
            flex: 1;
        }

        /* Promosi & Buta Warna */
        .promo-section {
            background: linear-gradient(to right, #f8f9fa, #e7f5ff);
            display: flex;
            align-items: center;
            gap: 30px;
            padding: 25px;
            width: 100%;
        }

        .promo-image {
            flex: 0 0 180px;
        }

        .promo-image img {
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            height: 180px;
            object-fit: cover;
        }

        .promo-content {
            flex: 1;
        }

        .promo-content h3 {
            color: #1864ab;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }

        .promo-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            text-decoration: none;
            background-color: #40c057;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .promo-btn:hover {
            background-color: #2f9e44;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .colorblind-section {
            background: linear-gradient(to right, #fff3cd, #ffeaa7);
            display: flex;
            align-items: center;
            gap: 30px;
            padding: 25px;
            width: 100%;
        }

        .colorblind-icon {
            flex: 0 0 80px;
            text-align: center;
            font-size: 3rem;
            color: #e63946;
        }

        .colorblind-content {
            flex: 1;
        }

        .colorblind-content h3 {
            color: #e63946;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }

        /* Hasil Tes */
        .result-box {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #40c057;
            width: 100%;
        }

        .result-box h3 {
            color: #2b8a3e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 20px;
            width: 100%;
        }

        .tab-btn {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: #495057;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            color: #339af0;
        }

        .tab-btn.active {
            color: #1c7ed6;
            border-bottom-color: #1c7ed6;
            background-color: #e7f5ff;
        }

        .tab-content {
            display: none;
            width: 100%;
        }

        .tab-content.active {
            display: block;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
            color: #6c757d;
            font-size: 0.9rem;
            width: 100%;
        }

        /* Responsiveness */
        @media (max-width: 1100px) {
            .logo-container {
                position: relative;
                left: 0;
                top: 0;
                transform: none;
                justify-content: center;
                margin-bottom: 15px;
            }
            
            .main-header {
                padding: 25px 20px;
            }
        }

        @media (max-width: 900px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .promo-section, .colorblind-section {
                flex-direction: column;
                text-align: center;
            }
            
            .promo-image, .colorblind-icon {
                flex: 0 0 auto;
            }
            
            .promo-image {
                width: 150px;
            }
        }

        @media (max-width: 600px) {
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .astigmatism-wheel {
                width: 250px;
                height: 250px;
            }
            
            .logo {
                height: 50px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .visus-value {
                font-size: 0.8rem;
                min-width: 50px;
                left: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Header dengan lebar penuh -->
    <header class="main-header">
        <div class="logo-container">
            <img src="https://via.placeholder.com/60x60/1e3c72/FFFFFF?text=FKU.PH" alt="FKUPH Logo" class="logo" id="fkupLogo">
            <img src="https://via.placeholder.com/60x60/2a5298/FFFFFF?text=KKLP" alt="KKLP Logo" class="logo" id="kklpLogo">
        </div>
        <h1><i class="fas fa-eye"></i> Alat Skrining Mata</h1>
        <p class="subtitle">Pemeriksaan Visus dan Buta Warna Berbasis Web</p>
        <p class="subtitle">Untuk penggunaan dengan bantuan dokter</p>
    </header>

    <!-- Container utama dengan grid 2 kolom -->
    <div class="main-container">
        <!-- Tes Visus - Section kiri -->
        <div class="main-section">
            <h2 class="section-title"><i class="fas fa-chart-line"></i> Tes Ketajaman Visual (Visus)</h2>
            
            <div class="instruction-box">
                <h3><i class="fas fa-info-circle"></i> Petunjuk Pemeriksaan</h3>
                <p>Pasien duduk dengan jarak <strong>2 meter</strong> dari layar. Tentukan mata yang akan diperiksa (mata kanan/kiri). Tutup mata yang tidak diperiksa. Pasien diminta membaca huruf dari baris atas ke bawah. Nilai visus ditampilkan di sebelah kiri setiap baris. Jika menggunakan trial lens, masukkan nilai koreksi di bawah.</p>
            </div>

            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="snellen-tab">Snellen Chart</button>
                <button class="tab-btn" data-tab="tumbling-tab">Tumbling E</button>
                <button class="tab-btn" data-tab="astigmatism-tab">Astigmatisma</button>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label for="eyeSelect">Mata yang Diperiksa:</label>
                    <select id="eyeSelect">
                        <option value="right">Mata Kanan</option>
                        <option value="left">Mata Kiri</option>
                        <option value="both">Kedua Mata</option>
                    </select>
                </div>
                
                <button id="generateChart"><i class="fas fa-sync-alt"></i> Generate Chart Baru</button>
            </div>

            <!-- Tab Snellen Chart -->
            <div class="tab-content active" id="snellen-tab">
                <div class="chart-container" id="snellenContainer">
                    <!-- Snellen chart akan di-generate oleh JavaScript -->
                </div>
            </div>

            <!-- Tab Tumbling E -->
            <div class="tab-content" id="tumbling-tab">
                <div class="chart-container" id="tumblingContainer">
                    <!-- Tumbling E chart akan di-generate oleh JavaScript -->
                </div>
            </div>

            <!-- Tab Astigmatisma -->
            <div class="tab-content" id="astigmatism-tab">
                <div class="instruction-box">
                    <h3><i class="fas fa-info-circle"></i> Petunjuk Tes Astigmatisma</h3>
                    <p>Pasien melihat lingkaran dengan jarak 2 meter dari layar. Pasien diminta melihat setiap garis pada roda astigmatisma. Jika ada garis yang terlihat lebih jelas, lebih tebal, atau lebih gelap dari yang lain, kemungkinan ada astigmatisma.</p>
                </div>
                
                <div class="astigmatism-container">
                    <div class="astigmatism-wheel" id="astigmatismWheel">
                        <!-- Garis astigmatisma akan di-generate oleh JavaScript -->
                    </div>
                    <div class="control-group">
                        <label for="astigmatismResult">Hasil Tes Astigmatisma:</label>
                        <select id="astigmatismResult">
                            <option value="">Pilih hasil...</option>
                            <option value="normal">Normal (Semua garis sama jelas)</option>
                            <option value="suspected">Diduga Astigmatisma (Ada garis lebih jelas)</option>
                            <option value="positive">Astigmatisma Positif (Beberapa garis sangat jelas)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="control-group">
                    <label for="trialLens">Koreksi Trial Lens (D):</label>
                    <input type="text" id="trialLens" placeholder="Contoh: -1.50, +2.00">
                </div>
                
                <div class="control-group">
                    <label for="visusResult">Hasil Visus (Manual):</label>
                    <input type="text" id="visusResult" placeholder="Contoh: 6/12, 20/40">
                </div>
                
                <div class="control-group">
                    <label for="autoVisus">Hasil Visus (Otomatis):</label>
                    <input type="text" id="autoVisus" placeholder="Akan terisi otomatis" readonly>
                </div>
            </div>
            
            <div class="controls">
                <button class="primary-btn" id="saveVisus"><i class="fas fa-save"></i> Simpan Hasil Visus</button>
                <button class="secondary-btn" id="calculateVisus"><i class="fas fa-calculator"></i> Hitung Visus Otomatis</button>
            </div>
            
            <div class="result-box" id="visusResultBox" style="display: none;">
                <h3><i class="fas fa-clipboard-check"></i> Hasil Tes Visus</h3>
                <p id="visusResultText"></p>
            </div>
        </div>

        <!-- Section kanan (kosong untuk sekarang, bisa diisi dengan informasi tambahan) -->
        <div class="main-section">
            <h2 class="section-title"><i class="fas fa-info-circle"></i> Informasi Tambahan</h2>
            
            <div class="instruction-box">
                <h3><i class="fas fa-ruler"></i> Konversi Nilai Visus</h3>
                <p>Nilai visus mengindikasikan ketajaman penglihatan seseorang. Berikut adalah konversi nilai visus:</p>
                <ul style="padding-left: 20px; margin-top: 10px;">
                    <li><strong>6/6</strong> = Penglihatan normal</li>
                    <li><strong>6/12</strong> = Dapat membaca pada jarak 6m apa yang orang normal baca pada 12m</li>
                    <li><strong>6/60</strong> = Hanya dapat membaca huruf terbesar pada chart</li>
                    <li><strong>CF</strong> = Counting Fingers (hitung jari)</li>
                    <li><strong>HM</strong> = Hand Movement (gerakan tangan)</li>
                    <li><strong>PL</strong> = Perception of Light (hanya persepsi cahaya)</li>
                </ul>
            </div>
            
            <div class="instruction-box">
                <h3><i class="fas fa-user-md"></i> Panduan untuk Dokter</h3>
                <p>1. Pastikan pencahayaan ruangan cukup (tidak silau dan tidak gelap)</p>
                <p>2. Pasien tidak menggunakan kacamata atau lensa kontak saat pemeriksaan (kecuali trial lens)</p>
                <p>3. Jika hasil visus kurang dari 6/12, pertimbangkan untuk pemeriksaan refraksi lebih lanjut</p>
                <p>4. Untuk pasien dengan astigmatisma positif, rujuk ke dokter mata untuk koreksi silinder</p>
            </div>
            
            <div class="instruction-box">
                <h3><i class="fas fa-exclamation-triangle"></i> Indikasi Rujukan</h3>
                <p>Pasien perlu dirujuk ke spesialis mata jika:</p>
                <ul style="padding-left: 20px; margin-top: 10px;">
                    <li>Visus < 6/12 pada salah satu atau kedua mata</li>
                    <li>Ada keluhan penglihatan ganda</li>
                    <li>Ada riwayat trauma mata</li>
                    <li>Ada keluhan nyeri mata atau merah mendadak</li>
                    <li>Hasil tes astigmatisma positif</li>
                </ul>
            </div>
        </div>

        <!-- Form Kesimpulan - Section lebar penuh -->
        <div class="full-width-section conclusion-form">
            <h2 class="section-title"><i class="fas fa-file-medical"></i> Kesimpulan Pemeriksaan</h2>
            
            <div class="form-row">
                <div class="control-group">
                    <label for="patientName">Nama Pasien:</label>
                    <input type="text" id="patientName" placeholder="Masukkan nama pasien">
                </div>
                
                <div class="control-group">
                    <label for="patientAge">Usia:</label>
                    <input type="number" id="patientAge" placeholder="Usia pasien">
                </div>
                
                <div class="control-group">
                    <label for="examDate">Tanggal Pemeriksaan:</label>
                    <input type="date" id="examDate">
                </div>
            </div>
            
            <label for="conclusion">Kesimpulan Pemeriksaan:</label>
            <textarea id="conclusion" placeholder="Masukkan kesimpulan hasil pemeriksaan mata..."></textarea>
            
            <div class="controls">
                <button id="generateConclusion"><i class="fas fa-file-pdf"></i> Generate Laporan</button>
                <button class="primary-btn" id="resetForm"><i class="fas fa-redo"></i> Reset Form</button>
            </div>
        </div>

        <!-- Section Buta Warna - Section lebar penuh -->
        <div class="full-width-section colorblind-section">
            <div class="colorblind-icon">
                <i class="fas fa-eye-dropper"></i>
            </div>
            
            <div class="colorblind-content">
                <h3><i class="fas fa-palette"></i> Pemeriksaan Buta Warna Lengkap</h3>
                <p>Untuk pemeriksaan buta warna yang lebih lengkap dan akurat, kami menyediakan alat tes buta warna online yang dapat diakses secara gratis. Tes ini menggunakan metode Ishihara yang standar untuk mendeteksi kelainan penglihatan warna.</p>
                <p>Alat tes buta warna kami menyediakan berbagai plate Ishihara dengan analisis hasil yang detail untuk membantu diagnosis.</p>
                <a href="https://github.com/hendrikkho-akupuntur/SahliRGB/ButaWarna.html" class="promo-btn" target="_blank" style="background-color: #e63946;">
                    <i class="fas fa-flask"></i> Akses Tes Buta Warna Lengkap
                </a>
            </div>
        </div>

        <!-- Promosi - Section lebar penuh -->
        <div class="full-width-section promo-section">
            <div class="promo-image">
                <!-- Foto Dr. Hendrik dari file lokal -->
                <img src="https://images.unsplash.com/photo-1582750433449-648ed127bb54?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Dr. Hendrik - Spesialis Akupuntur" id="drHendrikPhoto">
            </div>
            
            <div class="promo-content">
                <h3><i class="fas fa-bone"></i> Mengalami Nyeri Punggung atau Kebas Saraf?</h3>
                <p>Nyeri punggung dan kebas saraf dapat mengganggu aktivitas sehari-hari. Dr. Hendrik, spesialis akupuntur dengan pengalaman lebih dari 15 tahun, menawarkan terapi akupuntur yang terbukti efektif untuk mengurangi nyeri dan memperbaiki fungsi saraf.</p>
                <p>Terapi kami menggunakan teknik akupuntur modern yang aman dan nyaman, telah membantu ratusan pasien mendapatkan kualitas hidup yang lebih baik.</p>
                <a href="https://hendrikkho-akupuntur.github.io/profile/profile%20dr%20Hendrik%20akupuntur.html" class="promo-btn" target="_blank">
                    <i class="fas fa-user-md"></i> Konsultasi dengan Dr. Hendrik
                </a>
            </div>
        </div>
    </div>

    <footer>
        <p>Alat Skrining Mata - Dikembangkan Oleh Prodi PPDS KKLP FK UPH - dr Hendrik</p>
        <p>Â© 2025 - Program Studi Spesialis Kedokteran Primer FK UPH</p>
    </footer>

    <script>
        // Data untuk Snellen Chart (ukuran huruf dalam satuan pixel untuk jarak 2m)
        const snellenData = [
            { row: 1, letters: ["E"], size: 120, visus: "6/60" },
            { row: 2, letters: ["F", "P"], size: 100, visus: "6/48" },
            { row: 3, letters: ["T", "O", "Z"], size: 85, visus: "6/36" },
            { row: 4, letters: ["L", "P", "E", "D"], size: 70, visus: "6/24" },
            { row: 5, letters: ["P", "E", "C", "F", "D"], size: 55, visus: "6/18" },
            { row: 6, letters: ["E", "D", "F", "C", "Z", "P"], size: 45, visus: "6/12" },
            { row: 7, letters: ["F", "E", "L", "O", "P", "Z", "D"], size: 35, visus: "6/9" },
            { row: 8, letters: ["D", "E", "F", "P", "O", "T", "E", "C"], size: 25, visus: "6/6" }
        ];

        // Variabel global
        let visusResultSaved = false;
        let lastRowRead = -1; // Menyimpan baris terakhir yang bisa dibaca

        // Inisialisasi halaman
        document.addEventListener('DOMContentLoaded', function() {
            // Set tanggal hari ini
            document.getElementById('examDate').valueAsDate = new Date();
            
            // Generate chart awal
            generateSnellenChart();
            generateTumblingEChart();
            generateAstigmatismWheel();
            
            // Setup event listeners
            setupEventListeners();
            
            // Ganti URL logo dengan file lokal jika ada
            replaceLogosWithLocal();
            
            // Ganti foto Dr. Hendrik dengan file lokal
            replacePhotoWithLocal();
        });

        // Fungsi untuk mengganti logo dengan file lokal
        function replaceLogosWithLocal() {
            // Coba muat logo dari file lokal
            const fkupLogo = document.getElementById('fkupLogo');
            const kklpLogo = document.getElementById('kklpLogo');
            
            // Buat objek Image untuk cek apakah file ada
            const testImage1 = new Image();
            testImage1.onload = function() {
                fkupLogo.src = "fkuph.jpg";
            };
            testImage1.onerror = function() {
                console.log("Logo fkuph.jpg tidak ditemukan, menggunakan placeholder");
            };
            testImage1.src = "fkuph.jpg";
            
            const testImage2 = new Image();
            testImage2.onload = function() {
                kklpLogo.src = "KKLP.jpg";
            };
            testImage2.onerror = function() {
                console.log("Logo KKLP.jpg tidak ditemukan, menggunakan placeholder");
            };
            testImage2.src = "KKLP.jpg";
        }

        // Fungsi untuk mengganti foto Dr. Hendrik dengan file lokal
        function replacePhotoWithLocal() {
            const drHendrikPhoto = document.getElementById('drHendrikPhoto');
            
            // Buat objek Image untuk cek apakah file ada
            const testImage = new Image();
            testImage.onload = function() {
                drHendrikPhoto.src = "Hendrik.jpg";
                drHendrikPhoto.alt = "Dr. Hendrik - Spesialis Akupuntur";
            };
            testImage.onerror = function() {
                console.log("Foto Hendrik.jpg tidak ditemukan, menggunakan placeholder");
            };
            testImage.src = "Hendrik.jpg";
        }

        // Fungsi untuk generate Snellen chart dengan nilai visus
        function generateSnellenChart() {
            const chartContainer = document.getElementById('snellenContainer');
            chartContainer.innerHTML = '';
            
            snellenData.forEach((rowData, rowIndex) => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'chart-row';
                rowDiv.dataset.rowIndex = rowIndex;
                
                // Tambahkan nilai visus di sebelah kiri
                const visusValue = document.createElement('div');
                visusValue.className = 'visus-value';
                visusValue.textContent = rowData.visus;
                rowDiv.appendChild(visusValue);
                
                // Tambahkan event listener untuk menandai baris yang dibaca
                rowDiv.addEventListener('click', function() {
                    markRowAsRead(rowIndex, 'snellen');
                });
                
                rowData.letters.forEach(letter => {
                    const letterDiv = document.createElement('div');
                    letterDiv.className = 'chart-letter';
                    letterDiv.style.fontSize = `${rowData.size}px`;
                    letterDiv.textContent = letter;
                    
                    rowDiv.appendChild(letterDiv);
                });
                
                chartContainer.appendChild(rowDiv);
            });
        }

        // Fungsi untuk generate Tumbling E chart dengan nilai visus
        function generateTumblingEChart() {
            const chartContainer = document.getElementById('tumblingContainer');
            chartContainer.innerHTML = '';
            
            snellenData.forEach((rowData, rowIndex) => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'chart-row';
                rowDiv.dataset.rowIndex = rowIndex;
                
                // Tambahkan nilai visus di sebelah kiri
                const visusValue = document.createElement('div');
                visusValue.className = 'visus-value';
                visusValue.textContent = rowData.visus;
                rowDiv.appendChild(visusValue);
                
                // Tambahkan event listener untuk menandai baris yang dibaca
                rowDiv.addEventListener('click', function() {
                    markRowAsRead(rowIndex, 'tumbling');
                });
                
                rowData.letters.forEach(letter => {
                    const letterDiv = document.createElement('div');
                    letterDiv.className = 'chart-letter';
                    letterDiv.style.fontSize = `${rowData.size}px`;
                    
                    // Untuk Tumbling E, tentukan arah acak
                    const directions = [0, 90, 180, 270];
                    const randomDirection = directions[Math.floor(Math.random() * directions.length)];
                    letterDiv.innerHTML = `<div class="letter-E" style="transform: rotate(${randomDirection}deg);">E</div>`;
                    
                    rowDiv.appendChild(letterDiv);
                });
                
                chartContainer.appendChild(rowDiv);
            });
        }

        // Fungsi untuk generate roda astigmatisma
        function generateAstigmatismWheel() {
            const wheel = document.getElementById('astigmatismWheel');
            wheel.innerHTML = '';
            
            // Buat 12 garis dengan interval 30 derajat
            for (let i = 0; i < 12; i++) {
                const line = document.createElement('div');
                line.className = 'astigmatism-line';
                line.style.transform = `rotate(${i * 30}deg)`;
                
                // Buat beberapa garis sedikit lebih tebal untuk mensimulasikan variasi
                if (i % 4 === 0) {
                    line.style.height = '3px';
                    line.style.backgroundColor = '#333';
                }
                
                wheel.appendChild(line);
            }
        }

        // Fungsi untuk menandai baris yang sudah dibaca
        function markRowAsRead(rowIndex, chartType) {
            const containerId = chartType === 'snellen' ? 'snellenContainer' : 'tumblingContainer';
            const chartContainer = document.getElementById(containerId);
            
            // Hapus semua tanda sebelumnya
            chartContainer.querySelectorAll('.chart-row').forEach(row => {
                row.style.backgroundColor = '';
            });
            
            // Tandai semua baris dari atas hingga baris yang diklik
            for (let i = 0; i <= rowIndex; i++) {
                const row = chartContainer.querySelector(`.chart-row[data-row-index="${i}"]`);
                if (row) {
                    row.style.backgroundColor = '#e7f5ff';
                }
            }
            
            // Simpan baris terakhir yang dibaca
            lastRowRead = rowIndex;
            
            // Update nilai visus otomatis
            updateAutoVisus();
        }

        // Fungsi untuk menghitung visus otomatis berdasarkan baris yang dibaca
        function updateAutoVisus() {
            if (lastRowRead >= 0) {
                const visusValue = snellenData[lastRowRead].visus;
                document.getElementById('autoVisus').value = visusValue;
                
                // Juga update input manual jika kosong
                if (!document.getElementById('visusResult').value) {
                    document.getElementById('visusResult').value = visusValue;
                }
            }
        }

        // Fungsi untuk menghitung visus berdasarkan jarak
        function calculateVisusFromDistance() {
            // Jika tidak ada baris yang ditandai, coba hitung dari input manual
            if (lastRowRead < 0) {
                const manualVisus = document.getElementById('visusResult').value;
                if (manualVisus) {
                    document.getElementById('autoVisus').value = manualVisus;
                    return;
                }
                
                alert("Silakan tandai baris terakhir yang bisa dibaca dengan mengklik pada baris tersebut, atau masukkan nilai visus manual.");
                return;
            }
            
            // Hitung visus berdasarkan baris yang dibaca
            const visusValue = snellenData[lastRowRead].visus;
            document.getElementById('autoVisus').value = visusValue;
            
            // Tampilkan penjelasan perhitungan
            const explanation = `Nilai visus ${visusValue} berarti pada jarak 6 meter, pasien dapat membaca huruf yang seharusnya bisa dibaca normal pada jarak ${visusValue.split('/')[1]} meter.`;
            
            alert(`Hasil visus otomatis: ${visusValue}\n\n${explanation}\n\nPada pemeriksaan dengan jarak 2 meter, konversi nilai ini tetap akurat untuk skrining.`);
        }

        // Fungsi untuk setup event listeners
        function setupEventListeners() {
            // Navigasi tab
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // Hapus kelas active dari semua tab
                    document.querySelectorAll('.tab-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Tambah kelas active ke tab yang diklik
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Reset lastRowRead saat ganti tab
                    lastRowRead = -1;
                    
                    // Reset warna baris
                    const containerId = tabId === 'snellen-tab' ? 'snellenContainer' : 
                                      (tabId === 'tumbling-tab' ? 'tumblingContainer' : null);
                    if (containerId) {
                        document.getElementById(containerId).querySelectorAll('.chart-row').forEach(row => {
                            row.style.backgroundColor = '';
                        });
                    }
                });
            });
            
            // Generate chart baru
            document.getElementById('generateChart').addEventListener('click', function() {
                const activeTab = document.querySelector('.tab-btn.active').getAttribute('data-tab');
                
                if (activeTab === 'snellen-tab') {
                    generateSnellenChart();
                } else if (activeTab === 'tumbling-tab') {
                    generateTumblingEChart();
                } else if (activeTab === 'astigmatism-tab') {
                    generateAstigmatismWheel();
                }
                
                // Reset lastRowRead
                lastRowRead = -1;
                document.getElementById('autoVisus').value = '';
            });
            
            // Hitung visus otomatis
            document.getElementById('calculateVisus').addEventListener('click', calculateVisusFromDistance);
            
            // Simpan hasil visus
            document.getElementById('saveVisus').addEventListener('click', function() {
                const trialLens = document.getElementById('trialLens').value;
                const visusResult = document.getElementById('visusResult').value;
                const autoVisus = document.getElementById('autoVisus').value;
                const eyeSelected = document.getElementById('eyeSelect').value;
                const eyeText = getEyeText(eyeSelected);
                
                // Ambil hasil astigmatisma jika tab aktif
                const astigmatismResult = document.getElementById('astigmatismResult').value;
                let astigmatismText = "";
                
                if (astigmatismResult) {
                    const astigmatismLabels = {
                        'normal': 'Normal (tidak ada astigmatisma)',
                        'suspected': 'Diduga astigmatisma',
                        'positive': 'Astigmatisma positif'
                    };
                    astigmatismText = ` | Astigmatisma: ${astigmatismLabels[astigmatismResult]}`;
                }
                
                // Gunakan nilai visus otomatis jika ada, jika tidak gunakan manual
                const finalVisus = autoVisus || visusResult;
                
                if (!finalVisus) {
                    alert("Silakan masukkan atau hitung nilai visus terlebih dahulu.");
                    return;
                }
                
                let resultText = `Hasil pemeriksaan visus ${eyeText}: ${finalVisus}`;
                
                if (trialLens) {
                    resultText += ` dengan koreksi trial lens ${trialLens} D`;
                }
                
                resultText += astigmatismText;
                
                // Tambahkan konversi ke decimal jika format 6/X
                if (finalVisus.includes('/')) {
                    const parts = finalVisus.split('/');
                    if (parts.length === 2 && !isNaN(parts[0]) && !isNaN(parts[1])) {
                        const decimalValue = (parseInt(parts[0]) / parseInt(parts[1])).toFixed(2);
                        resultText += ` (${decimalValue} dalam format decimal)`;
                    }
                }
                
                // Tampilkan hasil
                document.getElementById('visusResultText').textContent = resultText;
                document.getElementById('visusResultBox').style.display = 'block';
                visusResultSaved = true;
            });
            
            // Generate laporan
            document.getElementById('generateConclusion').addEventListener('click', function() {
                const patientName = document.getElementById('patientName').value;
                const patientAge = document.getElementById('patientAge').value;
                const examDate = document.getElementById('examDate').value;
                const conclusion = document.getElementById('conclusion').value;
                
                if (!patientName || !conclusion) {
                    alert("Harap isi nama pasien dan kesimpulan pemeriksaan sebelum membuat laporan.");
                    return;
                }
                
                // Ambil hasil visus jika sudah disimpan
                const visusResult = visusResultSaved ? document.getElementById('visusResultText').textContent : "Belum dilakukan";
                
                // Format laporan
                const report = `
LAPORAN PEMERIKSAAN MATA
========================
Program Studi Spesialis Kedokteran Primer FK UPH
Dikembangkan oleh Prodi PPDS KKLP FK UPH - dr Hendrik

DATA PASIEN:
Nama: ${patientName}
Usia: ${patientAge} tahun
Tanggal Pemeriksaan: ${examDate}

HASIL PEMERIKSAAN:
1. Tes Ketajaman Visual (Visus):
${visusResult}

2. Tes Buta Warna:
Pasien dirujuk ke alat tes buta warna lengkap di: 
https://github.com/hendrikkho-akupuntur/SahliRGB/ButaWarna.html

KESIMPULAN DOKTER:
${conclusion}

---
Alat Skrining Mata Digital
Dibuat dengan bantuan dokter
                `;
                
                // Simpan sebagai file teks
                const blob = new Blob([report], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Laporan_Mata_${patientName.replace(/\s+/g, '_')}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert("Laporan telah diunduh sebagai file teks.");
            });
            
            // Reset form
            document.getElementById('resetForm').addEventListener('click', function() {
                if (confirm("Apakah Anda yakin ingin mereset semua data pemeriksaan?")) {
                    // Reset form visus
                    document.getElementById('trialLens').value = '';
                    document.getElementById('visusResult').value = '';
                    document.getElementById('autoVisus').value = '';
                    document.getElementById('astigmatismResult').value = '';
                    document.getElementById('visusResultBox').style.display = 'none';
                    
                    // Reset chart warna
                    const activeTab = document.querySelector('.tab-btn.active').getAttribute('data-tab');
                    if (activeTab === 'snellen-tab' || activeTab === 'tumbling-tab') {
                        const containerId = activeTab === 'snellen-tab' ? 'snellenContainer' : 'tumblingContainer';
                        document.getElementById(containerId).querySelectorAll('.chart-row').forEach(row => {
                            row.style.backgroundColor = '';
                        });
                    }
                    
                    // Reset form kesimpulan
                    document.getElementById('patientName').value = '';
                    document.getElementById('patientAge').value = '';
                    document.getElementById('conclusion').value = '';
                    document.getElementById('examDate').valueAsDate = new Date();
                    
                    // Reset variabel
                    lastRowRead = -1;
                    visusResultSaved = false;
                    
                    alert("Form telah direset.");
                }
            });
        }

        // Fungsi pembantu
        function getEyeText(eyeValue) {
            switch(eyeValue) {
                case 'right': return 'mata kanan';
                case 'left': return 'mata kiri';
                case 'both': return 'kedua mata';
                default: return '';
            }
        }
    </script>
</body>
</html>